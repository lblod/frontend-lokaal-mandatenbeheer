<div class="au-c-body-container" {{did-insert this.setMandatarissen}}>
  <h1 class="au-u-h2 au-u-margin-bottom-small">{{@title}}</h1>
  <AuDataTable
    @content={{this.mandatarissen}}
    @noDataMessage="Geen mandatarissen gevonden"
    @sort={{@sort}}
    @page={{@page}}
    @size={{@size}}
    as |t|
  >
    <t.content as |c|>
      <c.header {{on "click" this.setMandatarissen}}>
        <AuDataTableThSortable
          @field="isBestuurlijkeAliasVan.gebruikteVoornaam"
          @currentSorting={{@sort}}
          @label="Voornaam"
        />
        <AuDataTableThSortable
          @field="isBestuurlijkeAliasVan.achternaam"
          @currentSorting={{@sort}}
          @label="Familienaam"
        />
        {{#if @showFractie}}
          <AuDataTableThSortable
            @field="heeftLidmaatschap.binnenFractie.naam"
            @currentSorting={{@sort}}
            @label="Fractie"
          />
        {{/if}}
        {{#if @showFunctie}}
          <AuDataTableThSortable
            @field="bekleedt.bestuursfunctie.label"
            @currentSorting={{@sort}}
            @label="Mandaat"
          />
        {{/if}}
        {{#if @showRangorde}}
          {{! template-lint-disable no-invalid-interactive }}
          <th {{on "click" this.sortByRangorde}}>Rangorde</th>
        {{/if}}
        {{#if @showBevoegdheid}}
          <AuDataTableThSortable
            @field="beleidsdomein"
            @currentSorting={{@sort}}
            @label="Bevoegdheid"
          />
        {{/if}}
        {{#if @showStartEndDate}}
          <AuDataTableThSortable
            @field="start"
            @currentSorting={{@sort}}
            @label="Start mandaat"
          />
          <AuDataTableThSortable
            @field="einde"
            @currentSorting={{@sort}}
            @label="Einde mandaat"
          />
        {{/if}}
      </c.header>

      <c.body as |row|>
        <Verkiezingen::EditOnHover
          @editFunction={{this.openModal}}
          @model={{row}}
          @helpText="Pas de persoon aan"
        >
          {{row.isBestuurlijkeAliasVan.gebruikteVoornaam}}
        </Verkiezingen::EditOnHover>
        <Verkiezingen::EditOnHover
          @editFunction={{this.openModal}}
          @model={{row}}
          @helpText="Pas de persoon aan"
        >
          {{row.isBestuurlijkeAliasVan.achternaam}}
        </Verkiezingen::EditOnHover>
        {{#if @showFractie}}
          <td>
            {{row.heeftLidmaatschap.binnenFractie.naam}}
          </td>
        {{/if}}
        {{#if @showFunctie}}
          <td>
            {{row.bekleedt.bestuursfunctie.label}}
          </td>
        {{/if}}
        {{#if @showRangorde}}
          {{#if (eq this.editRangorde row.id)}}
            <td {{on-click-outside this.closeEditRangorde}}>
              <Verkiezingen::RangordeInput
                @rangorde={{row.rangorde}}
                @updatedRangorde={{this.updateRangorde}}
              />
            </td>
          {{else}}
            <Verkiezingen::EditOnHover
              @editFunction={{this.openEditRangorde}}
              @model={{row}}
              @helpText="Pas de rangorde aan"
            >
              {{row.rangorde}}
            </Verkiezingen::EditOnHover>
          {{/if}}
        {{/if}}
        {{#if @showBevoegdheid}}
          {{#if (eq this.editBeleidsdomeinen row.id)}}
            <td {{on-click-outside this.closeEditBeleidsdomeinen}}>
              <Mandatarissen::BeleidsdomeinSelectorWithCreate
                @beleidsdomeinen={{row.beleidsdomein}}
                @onSelect={{this.updateBeleidsdomeinen}}
              />
            </td>
          {{else}}
            <Verkiezingen::EditOnHover
              @editFunction={{this.openEditBeleidsdomeinen}}
              @model={{row}}
              @helpText="Pas de beleidsdomeinen aan"
            >
              <Beleidsdomeinen @mandataris={{row}} />
            </Verkiezingen::EditOnHover>
          {{/if}}
        {{/if}}
        {{#if @showStartEndDate}}
          <td>
            {{moment-format row.start "DD-MM-YYYY"}}
          </td>
          <td>
            {{moment-format row.einde "DD-MM-YYYY"}}
          </td>
        {{/if}}
      </c.body>
    </t.content>
  </AuDataTable>
</div>

<AuModal
  @title="Selecteer een persoon"
  @modalOpen={{this.isModalOpen}}
  @closable={{true}}
  @closeModal={{this.closeModal}}
>
  <div class="au-o-box">
    <Person::Selector
      @person={{this.mandataris.isBestuurlijkeAliasVan}}
      @onUpdate={{this.updatePerson}}
      @inline="false"
    />
  </div>
</AuModal>