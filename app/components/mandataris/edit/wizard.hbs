<AuModal
  class="wizard-modal"
  @modalOpen={{@startFlow}}
  @closable={{true}}
  @closeModal={{fn (mut this.isUnsavedChangesModalOpen) true}}
>
  <:title>
    <p class="au-u-h4 au-u-regular">
      {{this.activeStep.label}}
    </p>
  </:title>
  <:body>
    {{#if this.activeStep.isMandatarisStep}}
      <Mandataris::Edit::Form
        @toggleModal={{this.nextStep}}
        @bestuurseenheid={{@bestuurseenheid}}
        @bestuursorgaanIT={{@bestuursorgaanIT}}
        @mandataris={{@mandataris}}
        @linkedMandataris={{@linkedMandataris}}
        @bestuursorganenTitle={{this.mandatarisTitle}}
        @isFractieRequired={{@isFractieRequired}}
        @onFormIsValid={{this.updateMandatarisStepCompleted}}
      />
    {{/if}}

    {{#if this.activeStep.isReplacementStep}}
      <Mandataris::Edit::ReplacementForm
        @mandataris={{@mandataris}}
        @bestuursorgaanIT={{@bestuursorgaanIT}}
        @bestuurseenheid={{this.bestuurseenheid}}
        @onFormIsValid={{this.updateReplacementStepCompleted}}
      />
    {{/if}}

    {{#if this.activeStep.isReasonStep}}
      <div>
        <AuLabel @required={{true}}>
          Reden van aanpassing
        </AuLabel>
        <PowerSelect
          @allowClear={{false}}
          @selected={{this.reasonForChange}}
          @options={{this.reasonForChangeOptions}}
          @onChange={{this.selectReasonForChange}}
          @searchEnabled={{true}}
          @noMatchesMessage="Geen resultaten"
          as |reason|
        >
          {{reason}}
        </PowerSelect>
      </div>
    {{/if}}
  </:body>
  <:footer>
    <AuToolbar as |Group|>
      <Group>
        <AuButtonGroup>
          {{#if this.activeStepIsFinalStep}}
            <AuButton
              {{on "click" this.onSaveChanges}}
              @loading={{this.isSaving}}
              @loadingMessage="Opslaan"
              @disabled={{this.isSaveButtonDisabled}}
            >
              Pas aan
            </AuButton>
          {{else}}
            <AuButton
              {{on "click" this.nextStep}}
              @disabled={{not this.activeStep.canContinueToNextStep}}
            >
              Volgende
            </AuButton>
          {{/if}}
          {{#unless this.activeStepIsFirstStep}}
            <AuButton
              {{on "click" this.previousStep}}
              @disabled={{this.isSaving}}
              @skin="secondary"
            >
              Vorige
            </AuButton>
          {{/unless}}
        </AuButtonGroup>
      </Group>
    </AuToolbar>
  </:footer>
</AuModal>

<Shared::UnsavedChangesModal
  @isModalOpen={{this.isUnsavedChangesModalOpen}}
  @closeModal={{fn (mut this.isUnsavedChangesModalOpen) false}}
  @onCancel={{fn (mut this.isUnsavedChangesModalOpen) false}}
  @onDiscard={{this.discardChanges}}
/>