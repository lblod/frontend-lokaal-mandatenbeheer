{{breadcrumb
  this.model.mandataris.bekleedt.bestuursfunctie.label
  route="mandatarissen.persoon.mandataris"
  model=this.model.mandataris.id
}}

<div class="au-o-grid au-u-padding">
  <div class="au-o-grid__item au-u-1-2">
    <p class="au-u-h2 au-u-medium">
      {{this.bestuursorganenTitle}}
    </p>
    <p class="au-u-h3">
      {{this.persoon.gebruikteVoornaam}}
      {{this.persoon.achternaam}}
    </p>
  </div>
  <div class="au-o-grid__item au-u-1-2 au-u-text-left">
    <div
      class="au-u-flex au-u-flex--end au-u-margin-bottom"
      {{did-insert (perform this.checkLegislatuur)}}
    >
      <AuButtonGroup class="au-u-flex--spaced-small">
        <Shared::Tooltip
          @showTooltip={{(or
            (not this.model.mandataris.isActive)
            this.isDisabledBecauseLegislatuur
          )}}
          @tooltipText={{this.toolTipText}}
        >
          <AuButton
            @disabled={{(or
              (not this.model.mandataris.isActive)
              this.isDisabledBecauseLegislatuur
            )}}
            {{on "click" (fn (mut this.isChanging) true)}}
          >Wijzig huidig mandaat</AuButton>
        </Shared::Tooltip>
        <Shared::Tooltip
          @showTooltip={{this.isDisabledBecauseLegislatuur}}
          @tooltipText={{this.toolTipText}}
          @alignment="right"
        >
          <AuButton
            @alert={{true}}
            @skin="secondary"
            @disabled={{this.isDisabledBecauseLegislatuur}}
            {{on "click" (fn (mut this.isCorrecting) true)}}
          >Corrigeer fouten</AuButton>
        </Shared::Tooltip>
      </AuButtonGroup>
    </div>
    <AuAlert
      @skin="info"
      @icon="info-circle"
      class="alert-grey-info-circle-icon"
    >
      Om een mandaat te bewerken, zoals een fractiewijziging, kies voor
      <span class="au-u-medium">Wijzig huidig mandaat</span>. Dit zal een nieuw
      mandaat starten met de gewijzigde situatie.
      <br />
      Om fouten te corrigeren, bijvoorbeeld een typefout of een foutieve
      startdatum, kies voor
      <span class="au-u-medium">Corrigeer fouten</span>.
    </AuAlert>
  </div>
</div>

<div class="au-c-body-container au-c-body-container--scroll">
  <div class="au-o-box">
    <Mandatarissen::MandatarisCard
      @mandataris={{@model.mandataris}}
      @bestuursperiode={{@model.selectedBestuursperiode}}
      @disableEdits={{this.isDisabledBecauseLegislatuur}}
    />
  </div>

  <div class="au-o-box">
    <Mandatarissen::MandatarisExtraInfoCard
      @mandataris={{@model.mandataris}}
      @form={{@model.mandatarisExtraInfoForm}}
      @canEdit={{not this.isDisabledBecauseLegislatuur}}
    />
  </div>

  <div class="au-o-box">
    <AuHeading @level="3" @skin="4">
      Historiek
    </AuHeading>

    <AuHr />

    <ul class="au-c-list-vertical">
      <Mandatarissen::History
        @mandataris={{@model.mandataris}}
        @mandatarissen={{@model.mandatarissen}}
        @form={{@model.mandatarisEditForm}}
      />
    </ul>
  </div>
</div>

<Mandatarissen::UpdateState
  @onCancel={{this.closeModals}}
  @isChanging={{this.isChanging}}
  @onStateChanged={{this.onUpdateState}}
  @mandataris={{this.model.mandataris}}
>
  <AuAlert
    @skin="info"
    @icon="info-circle"
    @size="small"
    @closable={{false}}
    class="au-u-margin-small"
  >
    <p><span class="au-u-medium">Wijzig mandataris</span>
      wordt gebruikt om bijvoorbeeld de fractie te wijzigen of de status van de
      mandataris aan te passen.Dit zal een nieuw mandaat starten met de
      gewijzigde situatie.</p>
  </AuAlert>
  {{#if @model.bestuurseenheid.isOCMW}}
    <AuAlert @skin="warning" @icon="alert-triangle" @closable={{false}}>
      Mandatarissen in het OCMW hebben vaak een corresponderend mandaat in de
      gemeente. Indien aan deze mandataris een corresponderend mandaat gekoppeld
      is in de gemeente zal je de koppeling breken door hier wijzigingen uit te
      voeren, in dat geval moet je wijzigingen aan beide mandaten manueel
      doorvoeren. Zijn ze gekoppeld en voeg je de wijzigingen uit in de
      gemeente, dan zullen de wijzigingen ook uitgevoerd worden in het OCMW
      (indien gewenst).
    </AuAlert>
  {{/if}}
</Mandatarissen::UpdateState>

<AuModal
  @title={{(concat
    "Corrigeer fouten " this.model.mandataris.bekleedt.bestuursfunctie.label
  )}}
  @modalOpen={{this.isCorrecting}}
  @closable={{true}}
  @closeModal={{this.closeModals}}
>
  <AuAlert
    @skin="info"
    @icon="info-circle"
    @size="small"
    @closable={{false}}
    class="center-alert-icon au-u-margin-small"
  >
    <p><span class="au-u-medium">Corrigeer fouten</span>
      wordt gebruikt om bijvoorbeeld typfouten of een foutieve startdatum aan te
      passen. Voor alle andere mandaatwijzigingen, zoals fractiewijzigingen,
      gebruik Wijzig huidige mandaat.</p>
  </AuAlert>
  {{#if @model.bestuurseenheid.isOCMW}}
    <AuAlert @skin="warning" @icon="alert-triangle" @closable={{false}}>
      Mandatarissen in het OCMW hebben vaak een corresponderend mandaat in de
      gemeente. Indien aan deze mandataris een corresponderend mandaat gekoppeld
      is in de gemeente zal je de koppeling breken door hier wijzigingen uit te
      voeren, in dat geval moet je wijzigingen aan beide mandaten manueel
      doorvoeren. Zijn ze gekoppeld en voeg je de wijzigingen uit in de
      gemeente, dan zullen de wijzigingen ook uitgevoerd worden in het OCMW
      (indien gewenst).
    </AuAlert>
  {{/if}}
  <div class="au-o-box">
    <Form::Instance
      @instanceId={{this.model.mandataris.id}}
      @form={{this.model.mandatarisEditForm}}
      @onSave={{this.onSave}}
      @onCancel={{this.closeModals}}
      @buildMetaTtl={{this.buildMetaTtl}}
      @formInitialized={{fn (mut this.formInitialized) true}}
    />
    {{#unless this.formInitialized}}
      <Skeleton::Forms::MandatarisCorrect />
    {{/unless}}
  </div>
</AuModal>

<Mandatarissen::Linked::Modal
  @recentUpdate={{this.correctedMandataris}}
  @mandataris={{this.model.mandataris.id}}
  @correct="true"
/>

<Mandatarissen::Linked::Modal
  @recentUpdate={{this.updatedStateMandataris}}
  @mandataris={{this.model.mandataris.id}}
  @newMandataris={{this.newMandataris.id}}
  @callback={{this.callbackAfterUpdate}}
  @updateState="true"
/>